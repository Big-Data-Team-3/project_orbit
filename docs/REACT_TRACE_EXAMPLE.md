# ReAct Trace Example

This document provides an example of a ReAct (Reasoning + Acting) trace generated by the Supervisor Agent during dashboard generation.

## Overview

A ReAct trace captures the complete reasoning and action sequence of the Supervisor Agent as it processes a query. Each trace contains:

- **Query**: The original question or task
- **Steps**: A sequence of Thought → Action → Observation triplets
- **Final Answer**: The conclusion or result
- **Metadata**: Timing, success status, and company information

## Trace Structure

```json
{
  "query": "Generate dashboard for Anthropic",
  "company_id": "anthropic",
  "started_at": "2025-01-15T10:30:00.000Z",
  "completed_at": "2025-01-15T10:35:23.456Z",
  "success": true,
  "final_answer": "Dashboard generated successfully with 8 sections covering company overview, business model, funding, growth momentum, market sentiment, risks, outlook, and disclosure gaps.",
  "total_steps": 4,
  "steps": [
    {
      "step_number": 1,
      "thought": "I need to gather information about Anthropic to generate a comprehensive dashboard. Let me start by retrieving the latest structured payload which contains company metadata, events, products, and leadership information.",
      "action": "get_latest_structured_payload",
      "action_input": {
        "company_id": "anthropic"
      },
      "observation": "Retrieved structured payload with 12 events, 3 products, and 8 leadership members. Company founded in 2021, latest funding round: Series C ($450M) in 2023.",
      "timestamp": "2025-01-15T10:30:15.123Z",
      "error": null
    },
    {
      "step_number": 2,
      "thought": "Now I need to search the vector database for additional context about Anthropic's business model, recent news, and market sentiment. This will help me create a comprehensive dashboard.",
      "action": "rag_search_company",
      "action_input": {
        "company_id": "anthropic",
        "query": "Anthropic business model, products, market position, recent developments",
        "top_k": 10
      },
      "observation": "Retrieved 10 relevant context items from vector database. Topics include: Claude AI model development, safety research initiatives, enterprise partnerships, competitive positioning against OpenAI, and recent product launches.",
      "timestamp": "2025-01-15T10:32:45.789Z",
      "error": null
    },
    {
      "step_number": 3,
      "thought": "I should check for any risk signals in the retrieved data. Let me search for potential layoffs, financial distress, or other risk indicators that should be highlighted in the dashboard.",
      "action": "report_layoff_signal",
      "action_input": {
        "company_id": "anthropic",
        "context": "Recent news and company data retrieved from RAG search"
      },
      "observation": "No layoff signals detected. Company shows positive growth indicators with recent hiring announcements and product launches.",
      "timestamp": "2025-01-15T10:34:12.456Z",
      "error": null
    },
    {
      "step_number": 4,
      "thought": "I have gathered sufficient information from both structured and unstructured sources. I can now generate a comprehensive dashboard that synthesizes all this information into the required sections: Company Overview, Business Model, Funding, Growth Momentum, Market Sentiment, Risks, Outlook, and Disclosure Gaps.",
      "action": "final_answer",
      "action_input": {
        "dashboard_sections": [
          "Company Overview",
          "Business Model and GTM",
          "Funding & Investor Profile",
          "Growth Momentum",
          "Visibility & Market Sentiment",
          "Risks and Challenges",
          "Outlook",
          "Disclosure Gaps"
        ]
      },
      "observation": "Dashboard generated successfully. Contains 8 sections with comprehensive analysis based on structured payload data and RAG context. Total length: 3,247 characters.",
      "timestamp": "2025-01-15T10:35:23.456Z",
      "error": null
    }
  ]
}
```

## Example: Failed Trace

Here's an example of a trace where an error occurred:

```json
{
  "query": "Generate dashboard for ExampleCorp",
  "company_id": "examplecorp",
  "started_at": "2025-01-15T11:00:00.000Z",
  "completed_at": "2025-01-15T11:02:15.789Z",
  "success": false,
  "final_answer": "Error: Failed to retrieve structured payload. Company data not found in storage.",
  "total_steps": 1,
  "steps": [
    {
      "step_number": 1,
      "thought": "I need to retrieve the structured payload for ExampleCorp to begin dashboard generation.",
      "action": "get_latest_structured_payload",
      "action_input": {
        "company_id": "examplecorp"
      },
      "observation": null,
      "timestamp": "2025-01-15T11:02:15.789Z",
      "error": "Company 'examplecorp' not found in structured payload storage. Please ensure the company has been processed through the initial load pipeline."
    }
  ]
}
```

## Action Types

The Supervisor Agent can perform the following actions:

| Action Type | Description | Input Parameters |
|------------|-------------|-----------------|
| `get_latest_structured_payload` | Retrieve structured company data (events, products, leadership) | `company_id` |
| `rag_search_company` | Search vector database for company context | `company_id`, `query`, `top_k` |
| `report_layoff_signal` | Check for risk signals (layoffs, financial distress) | `company_id`, `context` |
| `final_answer` | Generate final dashboard or conclusion | `dashboard_sections` or `answer` |

## Trace Storage

ReAct traces are stored in GCS alongside generated dashboards:

```
gs://bucket/dashboards/{company_id}/{timestamp}/
├── dashboard.md          # The generated dashboard
├── metadata.json        # Execution metadata
└── trace.json           # ReAct trace (this format)
```

## Usage in Monitoring

ReAct traces enable:

1. **Debugging**: Understand why the agent made specific decisions
2. **Auditing**: Track all actions taken during dashboard generation
3. **Performance Analysis**: Measure step durations and identify bottlenecks
4. **Error Analysis**: Review failed traces to improve error handling
5. **Compliance**: Maintain records of all automated decisions

## Integration with WorkflowGraph

When using `SupervisorAgent.execute_workflow()`, the ReAct trace is automatically generated from the `WorkflowState`. Each workflow node execution is converted to a ReAct step, providing a unified view of both the graph-based workflow and the ReAct reasoning process.

## Example: WorkflowGraph Trace

When executing via `execute_workflow()`, the trace includes workflow node executions:

```json
{
  "query": "Generate dashboard for Anthropic",
  "company_id": "anthropic",
  "started_at": "2025-01-15T10:30:00.000Z",
  "completed_at": "2025-01-15T10:38:45.123Z",
  "success": true,
  "final_answer": "Dashboard generated successfully through workflow: planner → data_generator → risk_detector → evaluator",
  "total_steps": 5,
  "steps": [
    {
      "step_number": 1,
      "thought": "Executing planner node",
      "action": "final_answer",
      "action_input": {"node_name": "planner"},
      "observation": "Node planner completed with status completed. Output available",
      "timestamp": "2025-01-15T10:30:05.123Z",
      "error": null
    },
    {
      "step_number": 2,
      "thought": "Executing data_generator node",
      "action": "final_answer",
      "action_input": {"node_name": "data_generator"},
      "observation": "Node data_generator completed with status completed. Dashboard generated with 8 sections.",
      "timestamp": "2025-01-15T10:33:20.456Z",
      "error": null
    },
    {
      "step_number": 3,
      "thought": "Executing risk_detector node",
      "action": "final_answer",
      "action_input": {"node_name": "risk_detector"},
      "observation": "Node risk_detector completed with status completed. No risks detected.",
      "timestamp": "2025-01-15T10:35:10.789Z",
      "error": null
    },
    {
      "step_number": 4,
      "thought": "Executing evaluator node",
      "action": "final_answer",
      "action_input": {"node_name": "evaluator"},
      "observation": "Node evaluator completed with status completed. Dashboard evaluation passed.",
      "timestamp": "2025-01-15T10:38:40.123Z",
      "error": null
    }
  ]
}
```

## Best Practices

1. **Always check `success` field** before using `final_answer`
2. **Review `steps` array** to understand the reasoning process
3. **Check `error` fields** in steps for detailed error information
4. **Use `timestamp` fields** for performance analysis
5. **Store traces** for compliance and debugging purposes

